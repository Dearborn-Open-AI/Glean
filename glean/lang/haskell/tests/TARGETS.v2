load("@fbcode_macros//build_defs:native_rules.bzl", "buck_filegroup")
load("//common/hs/hiedb:rules.bzl", "haskell_hiedb")
load("//glean/test/regression:regression_test.bzl", "glean_thrift_regression_test")

haskell_hiedb(
    name = "ffi-hiedb",
    deps = [
        "//glean/hs:ffi",
    ],
)

buck_filegroup(
    name = "ffi-cases",
    srcs = glob(["cases/ffi/**"]),
)

glean_thrift_regression_test(
    name = "tests",
    args = [
        "--service",
        "${GLEAN_SERVER}",
        "--repo-name",
        "${TEST_REPO_NAME}",
        "--repo-hash",
        "${TEST_REPO_HASH}",
        "--repo-path",
        "..",
        "--db-path",
        "$(location :ffi-hiedb)/hiedb",
        "--dont-create-db",
        "--relocatable-db",
    ],
    binary = "//glean/lang/haskell:indexer",
    root = "$(location :ffi-cases)",
)
